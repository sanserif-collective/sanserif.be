---
import clsx from 'clsx'

type Props = {
  class?: string
}

const { class: className } = Astro.props as Props
---

<skew-wrapper class={clsx('block', className)}>
  <slot />
</skew-wrapper>

<script>
  import { app } from 'scripts/app'
  import { gsap, ScrollTrigger } from 'gsap/all'

  const mapper = gsap.utils.mapRange(-10, 10, -8, 8)

  class SkewWrapper extends HTMLElement {
    private skewXSet = gsap.quickSetter(this, 'skewX', 'deg')
    private skew = () => this.skewXSet(mapper(app.globals.scrollVelocity))

    public async connectedCallback() {
      ScrollTrigger.create({
        trigger: this,
        onEnter: () => gsap.ticker.add(this.skew),
        onEnterBack: () => gsap.ticker.add(this.skew),
        onLeave: () => gsap.ticker.remove(this.skew),
        onLeaveBack: () => gsap.ticker.remove(this.skew)
      })
    }
  }

  window.customElements.define('skew-wrapper', SkewWrapper)
</script>
