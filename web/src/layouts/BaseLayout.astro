---
import type { Shared } from 'types/shared'
import FontFaces from 'components/FontFaces.astro'
import Header from 'components/Header.astro'
import Footer from 'components/Footer.astro'
import Sprite from 'components/Sprite.astro'
import { getGlobalData } from 'queries/getGlobal'

type Props = {
  meta: Shared.SEO.Meta
  disableFooter?: boolean
  namespace: string
}

if (!global.strapi) global.strapi = await getGlobalData()

const { meta, disableFooter = false, namespace = 'base' } = Astro.props as Props
---

<!doctype html>
<html lang="en">

  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <link rel="canonical" href={Astro.site} />
    <link rel="preconnect" href="https://res.cloudinary.com" />
    <slot name="preload" />
    <FontFaces />
  </head>

  <body class="fixed antialiased [text-rendering:optimizeLegibility] text-black bg-gray font-body uppercase variation-medium text-base cursor-none sm:relative">
    <div asscroll-container data-barba="wrapper">
      <Header />

      <div data-loading-translater>
        <div
          class="flex portrait:flex-col"
          asscroll-element
          data-barba="container"
          data-barba-namespace={namespace}
        >
          <main class="flex-shrink-0 flex portrait:flex-col">
            <slot />
          </main>

          {!disableFooter && <Footer />}
        </div>
      </div>

      <sanserif-progress-bar
        class="origin-left fixed h-2 bg-[color:var(--progress-color)] inset-x-0 bottom-0"
        style="transform: scaleX(0)"
      />
    </div>

    <sanserif-cursor
      class:list={[
        'pointer-events-none fixed border border-[color:var(--cursor-color)]',
        'rounded-full h-4 w-4 hover:border-[color:var(--cursor-color)] sm:hidden'
      ]}
    />

    <sanserif-cursor
      class:list={[
        'pointer-events-none fixed h-[4px] w-[4px] rounded-full',
        'bg-[color:var(--cursor-color)] hover:bg-[color:var(--cursor-color)] sm:hidden'
      ]}
      speed="0.1"
      data-cursor-scale
    />

    <div class="grid place-content-center h-screen w-screen fixed inset-0 bg-black text-white" data-loader>
      <marquee-carousel class="flex justify-center max-w-2xl overflow-hidden" direction="100" playing="eager">
        {[...new Array(3)].map(() => (
          <div class="flex-shrink-0 flex items-center text-center text-2xl pl-4 before:mr-4 before:h-4 before:w-4 before:bg-white before:rounded-full">
            <Sprite id="sanserif" class="w-[4.5em] h-[1em]" />
            <div class="variation-light flex items-center ml-4 before:mr-4 before:h-4 before:w-4 before:bg-white before:rounded-full">Collective</div>
          </div>
        ))}
      </marquee-carousel>
    </div>

    <div
      class="h-screen w-screen fixed inset-0 bg-black pointer-events-none"
      style="transform: scaleX(0)"
      data-loading-shutter
    />
  </body>

</html>

<script>
  import { createApp } from 'scripts/app'
  import asscroll from 'scripts/plugins/asscroll'
  import portrait from 'scripts/plugins/portrait'
  import barba from 'scripts/plugins/barba'
  import { refs } from 'scripts/plugins/refs'
  import { gsap, ScrollTrigger } from 'gsap/all'
  import NavigationMenu from 'scripts/components/NavigationMenu'
  import MenuButton from 'scripts/components/MenuButton'
  import NextLink from 'scripts/components/NextLink'
  import SkewWrapper from 'scripts/components/SkewWrapper'
  import { Marquee } from 'scripts/components/Marquee'
  import ProgressBar from 'scripts/components/ProgressBar'
  import ParallaxWrapper from 'scripts/components/ParallaxWrapper'
  import StickyServices from 'scripts/components/StickyServices'
  import { Team } from 'scripts/components/Team'
  import { Cursor } from 'scripts/components/Cursor'
  import { clickables } from 'scripts/plugins/clickables'

  const app = createApp()

  // GSAP plugins
  gsap.registerPlugin(ScrollTrigger)
  ScrollTrigger.normalizeScroll(true)

  // App plugins
  app.use(barba)
  app.use(portrait)
  app.use(asscroll)
  app.use(refs)
  app.use(clickables)

  window.customElements.define('menu-button', MenuButton)
  window.customElements.define('navigation-menu', NavigationMenu)
  window.customElements.define('next-link', NextLink)
  window.customElements.define('skew-wrapper', SkewWrapper)
  window.customElements.define('marquee-carousel', Marquee)
  window.customElements.define('sanserif-progress-bar', ProgressBar)
  window.customElements.define('parallax-wrapper', ParallaxWrapper)
  window.customElements.define('sticky-services', StickyServices)
  window.customElements.define('sanserif-team', Team)
  window.customElements.define('sanserif-cursor', Cursor)
</script>
